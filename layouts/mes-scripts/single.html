{{ define "main" }}
<main class="main">
  <article class="post-single">
    <header class="post-header">
      <h1>{{ .Title }}</h1>
      {{ partial "post-meta.html" . }}
    </header>

    {{/* Contenu rendu par Hugo */}}
    {{ $content := .Content }}

    {{/* Injection du bloc Usage au marqueur <!-- USAGE --> si .Params.usage est défini
         - normalise CRLF -> LF
         - passe par le renderer de code (Chroma) pour un rendu identique aux ```bash
    */}}
    {{ with .Params.usage }}
      {{ $raw := . | replace "\r\n" "\n" }}
      {{ $code := highlight $raw "bash" "" }}
      {{ $box := printf `
<div class="usage-box">
  <div class="usage-title">Usage</div>
  %s
</div>` $code }}
      {{ $content = replaceRE `(?s)<!--\s*USAGE\s*-->` $box $content }}
    {{ end }}

    {{/* Wrapper .no-cols pour garantir 1 colonne (css) */}}
    <div class="post-content no-cols">
      {{ $content | safeHTML }}
    </div>

    <footer class="post-footer" style="margin-top:1rem">
      {{ with .Params.categories }}
        <div class="terms categories">
          <strong>Catégories :</strong>
          {{ range $i, $c := . }}
            {{ if $i }}, {{ end }}
            <a href="{{ (printf "/categories/%s/" ($c | urlize)) | relLangURL }}">{{ $c }}</a>
          {{ end }}
        </div>
      {{ end }}

      {{ with .Params.tags }}
        <div class="terms tags" style="margin-top:.25rem">
          <strong>Tags :</strong>
          {{ range $i, $t := . }}
            {{ if $i }}, {{ end }}
            <a href="{{ (printf "/tags/%s/" ($t | urlize)) | relLangURL }}">#{{ $t }}</a>
          {{ end }}
        </div>
      {{ end }}
    </footer>

    <nav class="post-nav" style="margin-top:1.25rem; display:flex; justify-content:space-between; gap:1rem;">
      <div class="prev">
        {{ with .PrevInSection }}← <a href="{{ .RelPermalink }}">{{ .Title }}</a>{{ end }}
      </div>
      <div class="next">
        {{ with .NextInSection }}<a href="{{ .RelPermalink }}">{{ .Title }}</a> →{{ end }}
      </div>
    </nav>
  </article>
</main>
{{ end }}
