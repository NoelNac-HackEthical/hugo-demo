{{ define "main" }}
<main id="main" class="home-min">
  {{/* Paginer les contenus de type posts/post/writeups */}}
  {{ $pages := where .Site.RegularPages "Type" "in" (slice "posts" "post" "writeups") }}
  {{ $p := .Paginate $pages }}

  <ul class="post-list">
    {{ range $p.Pages }}
      {{/* Cherche image.jpg dans le bundle courant */}}
      {{ $cover := .Resources.GetMatch "image.jpg" }}
      {{ if $cover }}{{ $cover = $cover.Fit "1200x" }}{{ end }}

      <li class="post-item">
        <div class="post-body">
          <h2 class="post-title"><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>

          <div class="post-meta">
            Publié le {{ .Date | time.Format ":date_long" }}
            {{ if ne (.Lastmod.Format "2006-01-02") (.Date.Format "2006-01-02") }}
              et modifié le {{ .Lastmod | time.Format ":date_long" }}
            {{ end }}
          </div>

          <p class="post-summary">
            {{ with .Params.summary }}{{ . }}{{ else }}{{ .Summary | plainify | truncate 180 }}{{ end }}
          </p>

          {{ with .Params.tags }}
          <div class="post-tags">
            {{ range . }}
              <a href="{{ (printf "/tags/%s/" (urlize .)) | relURL }}" class="tag">#{{ . }}</a>
            {{ end }}
          </div>
          {{ end }}
        </div>

        {{ if $cover }}
        <a class="thumb-wrap" href="{{ .RelPermalink }}" aria-label="Ouvrir {{ .Title }}">
          <img
            src="{{ $cover.RelPermalink }}"
            alt="{{ .Title }}"
            loading="lazy" decoding="async"
            width="{{ $cover.Width }}" height="{{ $cover.Height }}" />
        </a>
        {{ end }}
      </li>
    {{ end }}
  </ul>

  {{ if gt $p.TotalPages 1 }}
  <nav class="pager">
    {{ if $p.HasPrev }}<a href="{{ $p.Prev.URL }}">← Plus récents</a>{{ end }}
    <span>Page {{ $p.PageNumber }} / {{ $p.TotalPages }}</span>
    {{ if $p.HasNext }}<a href="{{ $p.Next.URL }}">Plus anciens →</a>{{ end }}
  </nav>
  {{ end }}
</main>

<style>
  .home-min { max-width: 1000px; margin: 0 auto; padding: 1rem; }
  .post-list { list-style: none; margin: 0; padding: 0; display: grid; gap: 1rem; }

  /* Grille 2 colonnes : texte | image (à droite) */
  .post-item {
    display: grid;
    grid-template-columns: 1fr 220px;  /* ajuste 200–260px selon ton goût */
    gap: 1rem;
    align-items: stretch;              /* >>> étire l'image à la hauteur du texte <<< */
    border-bottom: 1px solid var(--border, rgba(127,127,127,.25));
    padding-bottom: 1rem;
  }

  .post-body { min-width: 0; }
  .post-title { font-size: 1.2rem; margin: 0 0 .25rem; }
  .post-title a { text-decoration: none; }
  .post-meta { font-size: .9rem; opacity: .8; margin-bottom: .4rem; }
  .post-summary { margin: 0 0 .5rem; }

  /* Vignette à droite, même hauteur que le bloc texte */
  .thumb-wrap {
    display: block;
    height: 100%;        /* >>> prend toute la hauteur de la ligne <<< */
    border-radius: 8px;
    overflow: hidden;    /* arrondis visibles avec object-fit */
  }
  .thumb-wrap img {
    display: block;
    width: 100%;
    height: 100%;        /* >>> égale à la hauteur du bloc texte <<< */
    object-fit: cover;   /* remplit sans déformer (rognage si besoin) */
  }

  .pager { display: flex; gap: .75rem; justify-content: center; margin-top: 1rem; }

  /* Responsive : empiler sur petits écrans */
  @media (max-width: 720px) {
    .post-item { grid-template-columns: 1fr; }
    .thumb-wrap { height: auto; }
    .thumb-wrap img { height: auto; }
  }
</style>
{{ end }}

