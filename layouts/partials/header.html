{{- /* layouts/partials/header.html — override PaperMod avec sous-menus */ -}}
<header class="header">
  <nav class="nav" aria-label="{{ i18n `mainMenu` | default `Main Menu` }}">
    {{/* --- Logo / Titre du site --- */}}
    <div class="logo">
      <a href="{{ "/" | relLangURL }}" accesskey="h" title="{{ site.Title }}">
        {{- with site.Params.label.icon -}}
          <span class="logo__mark">{{ . | safeHTML }}</span>
        {{- end -}}
        <span class="logo__text">{{ site.Title }}</span>
      </a>
    </div>

    {{/* --- Menu principal --- */}}
    <ul id="menu" class="menu">
      {{- $currentPage := . -}}
      {{- range site.Menus.main }}
        {{- $hasURL := .URL -}}
        {{- $menu_item_url := (cond (strings.HasSuffix .URL "/") .URL (printf "%s/" .URL) ) | absLangURL -}}
        {{- $page_url := $currentPage.Permalink | absLangURL -}}
        {{- $isActive := eq $menu_item_url $page_url -}}

        <li class="menu-item{{ if .HasChildren }} has-children{{ end }}">
          {{- if $hasURL }}
            <a href="{{ .URL | absLangURL }}" title="{{ .Title | default .Name }}">
              <span{{ if $isActive }} class="active"{{ end }}>
                {{- .Pre }}{{- .Name -}}{{ .Post -}}
              </span>
              {{- if (findRE "://" .URL) }}&nbsp;
                <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12" aria-hidden="true">
                  <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                  <path d="M15 3h6v6"></path>
                  <path d="M10 14L21 3"></path>
                </svg>
              {{- end }}
            </a>
          {{- else }}
            {{/* Parent conteneur sans URL */}}
            <button class="menu-parent" type="button" aria-haspopup="true" aria-expanded="false">
              <span>{{- .Pre }}{{- .Name -}}{{ .Post -}}</span>
            </button>
          {{- end }}

          {{- if .HasChildren }}
            <ul class="submenu" aria-label="{{ .Name }}">
              {{- range .Children }}
                <li class="submenu-item">
                  <a href="{{ .URL | absLangURL }}" title="{{ .Title | default .Name }}">
                    {{- .Name -}}
                  </a>
                </li>
              {{- end }}
            </ul>
          {{- end }}
        </li>
      {{- end }}
    </ul>

    {{/* --- Bouton thème (affiché si param activé) --- */}}
    {{- if site.Params.defaultTheme }}
      <button id="theme-toggle" aria-label="Toggle theme" title="Toggle theme">
        <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" aria-hidden="true"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
        <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" aria-hidden="true"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
      </button>
    {{- end }}
  </nav>
</header>
