/* ==========================================================================
   Custom site CSS – PaperMod (Noël)  [A1] Variables globales
   ========================================================================== */

:root{
  /* Layout TOC */
  --toc-width: 320px;
  --toc_droite: 0;        /* 1 = TOC à droite (défaut thème), 0 = TOC à gauche */
  --toc-stick: 2rem;      /* offset sticky des titres */
  --toc-align-box: 1.8rem;/* décale visuellement le panneau TOC */
  --toc-align-tweak: 0rem;

  /* Cadres */
  --summary-border: #555;

  /* Tags (clair) */
  --tag-fg: #1E90FF;
  --tag-bg: rgba(127,127,127,.15);
  --tag-fg-hover-light: #003366;
  --tag-bg-hover-light: rgba(127,127,127,.40);

  /* TOC active */
  --toc-active: #1E90FF;
}
html.dark, body.dark{
  --summary-border: #ccc;
  --tag-fg: #9ecbff;
  --tag-bg: rgba(255,255,255,.15);
  --tag-fg-hover-dark: #ffffff;
  --tag-bg-hover-dark: rgba(255,255,255,.30);
  --toc-active: #9ecbff;
}


/* ==========================================================================
   [B1] Mise en page des articles (grille de base: article | TOC)
   ========================================================================== */

.post-single{ display:block; } /* garde-fou si un style met flex */

.post-content{
  display:grid;
  grid-template-columns: minmax(0,1fr) var(--toc-width,320px);
  column-gap: 2rem;
  align-items:start;
}

/* Panneau TOC sticky (sans scrollbar interne) */
.post-content > #TableOfContents{
  grid-column:2;
  grid-row:1;
  position: sticky;
  top: var(--toc-stick);
  margin-top: var(--toc-align-box);
  z-index:5;

  max-height:none;
  overflow:visible;

  background: var(--entry);
  border:1px solid var(--border);
  border-radius:10px;
  padding:.75rem 1rem;
}

/* Neutralise l’ancienne astuce de décalage interne */
.post-content > #TableOfContents > ul{
  margin-top:0;
  transform:none;
}

.post-content > .post-article{
  grid-column:1;
  min-width:0;
}

/* Aligne les ancres des titres avec le haut du viewport */
.post-content h2,
.post-content h3,
.post-content h4{
  scroll-margin-top: var(--toc-stick);
}

/* Mobile (<= 991px) : TOC sous le contenu — comportement conservé */
@media (max-width: 991px){
  .post-content{ display:block; }
  .post-content > #TableOfContents{ position:static; margin-top:1rem; }
}


/* ==========================================================================
   [C1] HEADER d’article : résumé + vignette 120×120 + tags
   ========================================================================== */

.post-intro{ max-width:860px; margin:.25rem 0 .75rem; }

.post-intro .summary-image-row{
  display:flex; align-items:flex-start; gap:.75rem;
  border:1px solid var(--summary-border);
  border-radius:8px; padding:.75rem;
}
.post-intro .post-summary{ margin:0; }

.post-intro .thumb-wrap{
  display:block; border-radius:10px; overflow:hidden;
  flex-shrink:0; width:120px; height:120px;
}
.post-intro .thumb-wrap img{
  display:block; width:100%; height:100%; object-fit:cover;
}


/* ==========================================================================
   [D1] HOME : liste + cartes (résumé + vignette)
   ========================================================================== */

.home-min{ max-width:860px; margin:0 auto; padding:1rem; }

.post-list{ list-style:none; margin:0; padding:0; display:grid; gap:1rem; }
.post-item{ border-bottom:1px solid var(--border, rgba(127,127,127,.25)); padding-bottom:1rem; }
.post-title{ font-size:1.2rem; margin:0 0 .25rem; }
.post-title a{ text-decoration:none; }
.post-meta{ font-size:.9rem; opacity:.8; margin-bottom:.35rem; }
.post-summary{ margin:0; }

.summary-image-row{
  display:flex; align-items:flex-start; gap:.75rem; margin-top:.25rem;
  border:1px solid var(--summary-border);
  border-radius:8px; padding:.75rem;
}
.thumb-wrap{
  display:block; border-radius:10px; overflow:hidden;
  flex-shrink:0; width:120px; height:120px;
}
.thumb-wrap img{ display:block; width:100%; height:100%; object-fit:cover; }

.pager{ display:flex; gap:.75rem; justify-content:center; margin-top:1rem; }

@media (max-width:720px){
  .summary-image-row{ flex-direction:column; }
  .thumb-wrap{ width:100%; max-width:240px; height:auto; aspect-ratio:1/1; }
}


/* ==========================================================================
   [E1] Tags unifiés (home + writeups)
   ========================================================================== */

.post-tags{ display:flex; flex-wrap:wrap; gap:.4rem; margin-top:.25rem; }

.post-tags .tag{
  font-size:.85rem; font-weight:700; text-decoration:none;
  color:var(--tag-fg); background-color:var(--tag-bg);
  padding:.08rem .4rem; border-radius:999px; transition:.2s; outline:none;
}

html:not(.dark) .post-tags .tag:hover,
html:not(.dark) .post-tags .tag:focus-visible{
  color:var(--tag-fg-hover-light) !important;
  background-color:var(--tag-bg-hover-light) !important;
}

html.dark .post-tags .tag:hover,
html.dark .post-tags .tag:focus-visible,
body.dark .post-tags .tag:hover,
body.dark .post-tags .tag:focus-visible{
  color:var(--tag-fg-hover-dark) !important;
  background-color:var(--tag-bg-hover-dark) !important;
}

.post-tags .tag:focus-visible{
  outline:2px solid currentColor; outline-offset:2px;
}


/* ==========================================================================
   [F1] Surlignage Search (occurrences & active)
   ========================================================================== */

mark.__hl{ background:none; font-weight:700; }
html.dark mark.__hl{ color:#ffe066; }
html:not(.dark) mark.__hl{ color:#e67e22; }
mark.__hl.__hl-active{ background:#ffea70; }
html.dark mark.__hl.__hl-active{ color:#111; }
html:not(.dark) mark.__hl.__hl-active{ color:#b65e0e; }

.__hl-nav{
  position:fixed; right:.75rem; bottom:.75rem; z-index:9999;
  display:flex; align-items:center; gap:.35rem;
  background:var(--entry); border:1px solid var(--border);
  border-radius:8px; padding:.35rem .5rem;
}


/* ==========================================================================
   [G1] Numérotation automatique dans le CONTENU (H2/H3/H4)
   (non appliquée à la TOC)
   ========================================================================== */

.post-content{ counter-reset:h2counter; }
.post-content h2{ counter-reset:h3counter; }
.post-content h3{ counter-reset:h4counter; }

.post-content h2::before{
  counter-increment:h2counter;
  content: counter(h2counter) ". ";
  font-weight:600; margin-right:.25em;
}
.post-content h3::before{
  counter-increment:h3counter;
  content: counter(h2counter) "." counter(h3counter) " ";
  margin-right:.25em;
}
.post-content h4::before{
  counter-increment:h4counter;
  content: counter(h2counter) "." counter(h3counter) "." counter(h4counter) " ";
  margin-right:.25em;
}

.post-content h2.nonum::before,
.post-content h3.nonum::before,
.post-content h4.nonum::before{
  content:""; counter-increment:none;
}


/* ==========================================================================
   [H1] TOC – styles PaperMod + numérotation + liens non soulignés
   ========================================================================== */

#TableOfContents{ font-size:.90rem; } /* compact */

#TableOfContents a{ text-decoration:none !important; }
#TableOfContents a:hover{ text-decoration:none !important; }

/* Numérotation H2 */
#TableOfContents > ul{ counter-reset: toc-h2; }
#TableOfContents > ul > li{ counter-increment: toc-h2; }
#TableOfContents > ul > li > a::before{
  content: counter(toc-h2) ". ";
  margin-right:.25em;
}

/* Numérotation H3 */
#TableOfContents ul ul{ counter-reset: toc-h3; padding-left:1.15rem; }
#TableOfContents ul ul > li{ counter-increment: toc-h3; }
#TableOfContents ul ul > li > a::before{
  content: counter(toc-h2) "." counter(toc-h3) " ";
  margin-right:.25em;
}

/* Numérotation H4 */
#TableOfContents ul ul ul{ counter-reset: toc-h4; }
#TableOfContents ul ul ul > li{ counter-increment: toc-h4; }
#TableOfContents ul ul ul > li > a::before{
  content: counter(toc-h2) "." counter(toc-h3) "." counter(toc-h4) " ";
  margin-right:.25em;
}

/* Densité desktop */
@media (min-width: 992px){
  #TableOfContents a{ line-height:1.12 !important; }
  #TableOfContents li{ margin:.06rem 0 !important; }
  #TableOfContents ul{ margin:.10rem 0 !important; }
  #TableOfContents ul ul{ margin-top:.06rem !important; }
}

/* Neutraliser tous les soulignés possibles (thème) */
.post-content > #TableOfContents a,
.post-content > #TableOfContents a:link,
.post-content > #TableOfContents a:visited,
.post-content > #TableOfContents a:hover,
.post-content > #TableOfContents a:focus,
.post-content > #TableOfContents a:active{
  text-decoration:none !important;
  -webkit-text-decoration:none !important;
  text-decoration-line:none !important;
  border:0 !important; border-bottom:0 !important;
  box-shadow:none !important;
  background-image:none !important;
  background-size:0 0 !important;
  background-repeat:no-repeat !important;
  background-position:0 100% !important;
}
.post-content > #TableOfContents a::after{
  box-shadow:none !important;
  background-image:none !important;
  border:0 !important;
}

/* Item actif */
#TableOfContents a.is-active{
  color:var(--toc-active) !important;
  font-weight:600;
  text-decoration:none !important;
  border:0 !important;
  box-shadow:none !important;
  background-image:none !important;
}

/* Auto-collapse + chevrons (desktop) */
#TableOfContents li > ul{ display:none; }
#TableOfContents li.is-open > ul{ display:block; }
#TableOfContents li.has-children > a{
  position:relative; padding-right:1rem;
}
#TableOfContents li.has-children > a::after{
  content:"▸";
  position:absolute; right:0; top:.05rem;
  font-size:.9em; opacity:.8;
  transform:translateY(.1rem) rotate(0deg);
  transition:transform .15s ease;
}
#TableOfContents li.has-children.is-open > a::after{
  transform:translateY(.1rem) rotate(90deg);
}

/* Mobile : pas de repli (tout visible) */
@media (max-width: 991px){
  #TableOfContents li > ul{ display:block; }
  #TableOfContents li.has-children > a{ padding-right:0; }
  #TableOfContents li.has-children > a::after{ display:none; }
}


/* ==========================================================================
   [I1] HOME uniquement : clamp des résumés à exactement 4 lignes
   ========================================================================== */

.home-min .post-summary,
.home-min .post-entry .post-content,
.home-min .post-entry .entry-content,
.home-min .post-entry p{
  line-height:1.55;
  display:-webkit-box;
  -webkit-box-orient:vertical;
  -webkit-line-clamp: 4;
  overflow:hidden;
  min-height:calc(1.55em * 4);
  max-height:calc(1.55em * 4);

  display: -webkit-box;
  -webkit-box-orient: vertical;
  overflow: hidden;
}


/* ==========================================================================
   [J1] Desktop uniquement : TOC gauche/droite pilotée par --toc_droite
   ========================================================================== */

@media (min-width: 992px){
  .post-content{
    display:flex;               /* remplace la grille en desktop */
    align-items:flex-start;
    gap:2rem;                   /* identique au column-gap */
  }
  #TableOfContents{
    order: var(--toc_droite);   /* 1 => droite, 0 => gauche */
    flex: 0 0 var(--toc-width,320px);
    max-width: var(--toc-width,320px);
  }
  .post-article{
    order: calc(1 - var(--toc_droite));
    min-width:0;
    flex:1 1 auto;
  }
}

/* === PaperMod: désactiver la barre de défilement horizontale du menu en desktop === */
@media (hover: hover) and (min-width: 768px) {
  .header .nav ul.menu {
    overflow-x: visible !important;   /* pas de scroll horizontal */
    -ms-overflow-style: none !important; /* IE/Edge legacy */
    scrollbar-width: none !important;     /* Firefox */
  }
  .header .nav ul.menu::-webkit-scrollbar { display: none !important; } /* Chrome/Safari */
}

/* ======= Outils > Sous-menus (look soigné) ======= */

/* ancre et curseur */
#menu > li.has-children { position: relative; }
#menu > li.has-children > a,
#menu > li.has-children > .menu-parent { cursor: default; }

/* conteneur du dropdown */


/* ouverture au survol / focus clavier (desktop) */


/* items internes */
#menu > li.has-children > ul.submenu > li { margin: 0; }
#menu > li.has-children > ul.submenu > li > a {
  display: block;
  padding: .55rem .9rem;
  white-space: nowrap;
  text-decoration: none;
  border: 0;
  background: transparent;
  line-height: 1.2;
}

/* hover doux (compatible dark) */
#menu > li.has-children > ul.submenu > li > a:hover,
#menu > li.has-children > ul.submenu > li > a:focus {
  background: rgba(255,255,255,.06);
  outline: none;
}

/* évite que quelque chose masque le dropdown */
.header, .nav { position: relative; z-index: 1100; overflow: visible; }

/* supprime tout soulignement/trait fantôme sur les liens du header */
.header .nav ul.menu > li > a,
.header .nav ul.menu > li > a > span,
.header .nav ul.menu > li > a::before,
.header .nav ul.menu > li > a::after,
.header .nav ul.menu > li > a > span::before,
.header .nav ul.menu > li > a > span::after {
  text-decoration: none !important;
  background: none !important;
  background-image: none !important;
  border: 0 !important;
  box-shadow: none !important;
  outline: 0 !important;
  content: none !important;
}

/* pas de barre de scroll horizontale du menu en desktop */
@media (hover: hover) and (min-width: 768px) {
  .header .nav ul.menu { overflow-x: visible !important; }
  .header .nav ul.menu::-webkit-scrollbar { display: none !important; }
}

/* ---------- options esthétiques (facultatives) ---------- */

/* petit caret ▼ sur le parent */
#menu > li.has-children > a > span::after,
#menu > li.has-children > .menu-parent > span::after {
  content: " ▾";
  opacity: .7;
  font-size: .9em;
}

/* aligner le dropdown sur la droite du parent (si l’item est en bout de ligne) */
/* activer au besoin sur l'élément concerné avec une classe .align-right */
#menu > li.has-children.align-right > ul.submenu {
  left: auto; right: 0;
}

/* =========================
   Bloc Usage (mes-scripts)
   ========================= */

/* Conteneur encadré */
.usage-box{
  border:1px solid var(--border);
  background:var(--entry);
  border-radius:.5rem;
  padding:.75rem 1rem;
  margin:1rem 0;
}

/* Titre "Usage" */
.usage-box .usage-title{
  font-weight:600;
  opacity:.85;
  margin:0 0 .25rem 0;
}

/* Zone de code neutre : pas de coloration syntaxique */
.usage-box pre.usage-pre{
  margin:0;
  white-space:pre;          /* garde les retours à la ligne, pas de wrap */
  overflow:auto;            /* scroll horizontal si trop long */
  background:transparent;   /* fond neutre */
  color:inherit;            /* texte hérite de la couleur du thème */
  line-height:1.35;
  tab-size:4;
  font-family: var(--mono, ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace);
  font-size:.95rem;
}

/* Code à l’intérieur */
.usage-box pre.usage-pre code{
  white-space:inherit;
  background:transparent;
  color:inherit;            /* supprime toute coloration syntaxique */
}

/* =========================
   Forcer 1 colonne (pages no-cols)
   ========================= */
.post-single .post-content.no-cols{
  display:block!important;
  -webkit-column-count:1!important; -moz-column-count:1!important; column-count:1!important;
  -webkit-columns:auto!important;   -moz-columns:auto!important;   columns:auto!important;
  -webkit-column-width:auto!important; -moz-column-width:auto!important; column-width:auto!important;
  -webkit-column-gap:normal!important; -moz-column-gap:normal!important; column-gap:normal!important;
  grid-template-columns:none!important; -ms-grid-columns:none!important;
  writing-mode:horizontal-tb!important;
  word-break:normal!important;
}
.has-toc .post-single .post-content.no-cols{
  display:block!important;
  grid-template-columns:none!important;
}

.usage-box .usage-title{
  font-weight:600;
  opacity:.85;
  margin:0 0 .25rem 0;
}

/* Bloc Usage : pas de wrap + scroll horizontal si nécessaire */
.usage-box .highlight,
.usage-box pre {
  overflow-x: auto;          /* barre horizontale si ça dépasse */
  overflow-y: hidden;
}

.usage-box pre,
.usage-box code {
  white-space: pre !important;   /* ne jamais couper les lignes */
  word-break: normal !important; /* pas de césure */
}

/* --- Bloc "Télécharger le script" : 1 ligne texte + 2 boutons --- */

/* Ligne de version (texte simple) */
.version-line{
  margin:.25rem 0 .5rem;
  font-size:.95rem;
  color:var(--content);
}

/* Barre boutons */
.dl-row{
  display:flex;
  align-items:center;
  gap:.75rem;
  flex-wrap:wrap;
  margin:.75rem 0 1rem;
}

/* Boutons harmonisés (même look que la pastille d'avant) */
.dl-row .he-btn{
  display:inline-flex;
  align-items:center;
  padding:.45rem .85rem;
  font-size:.9rem;
  border-radius:.6rem;
  box-shadow:0 1px 2px rgba(0,0,0,.12);
  min-height:2.2rem;
}

/* Variante neutre + hover */
.he-btn--neutral{
  background:#3a3a3a;
  border-color:var(--border);
  color:var(--content);
}
.he-btn--neutral:hover{
  background:#505050;
  filter:brightness(1.08);
  transform:translateY(-1px);
}

/* Bouton compact (SHA256) */
.dl-row .he-btn.he-btn--sm{
  padding:.32rem .6rem;
  font-size:.78rem;
  min-height:1.8rem;
}

/* Focus propre */
.dl-row .he-btn:focus,
.dl-row .he-btn:active,
.dl-row .he-btn:focus-visible{
  outline:none;
  box-shadow:none;
}

/* ==================== AJOUT : MENU OUTILS COMPAT MOBILE/DESKTOP (PaperMod) ==================== */
/* Ne pas clipper les sous-menus */
.header, .nav, header, nav { overflow: visible !important; }

/* A) Cas PaperMod mobile natif : <details><summary>Outils</summary><ul>… */
.header .menu summary { cursor: pointer; list-style: none; }
.header .menu summary::-webkit-details-marker { display: none; }
.header .menu details > ul { display: none; }
.header .menu details[open] > ul { display: block; }

/* B) Cas “classique” : <li class="has-children"><a>Outils</a><ul>…</ul></li> */
@media (hover: none) {
  /* Par défaut, rien n’est visible sans ouverture explicite */
  #menu > li.has-children > ul,
  .menu > li.has-children > ul,
  nav .menu > li.has-children > ul { display: none !important; }

  /* Affiché si le parent porte .is-open (ajouté par JS si besoin) */
  #menu > li.has-children.is-open > ul,
  .menu > li.has-children.is-open > ul,
  nav .menu > li.has-children.is-open > ul { display: block !important; }
}

/* Sécurité : au-dessus des autres calques */
.header .menu details > ul,
#menu > li.has-children > ul,
.menu > li.has-children > ul { position: relative; z-index: 1200; }

/* Un peu d’air quand ouvert */
.header .menu details[open] > ul,
#menu > li.has-children.is-open > ul { margin-top: .25rem; }

/* ======= Outils > Sous-menus (desktop + mobile, PaperMod) ======= */

/* Le parent doit pouvoir positionner son dropdown */
#menu > li.has-children { position: relative; }
#menu > li.has-children > a,
#menu > li.has-children > .menu-parent { cursor: default; }

/* Styles visuels du dropdown (look desktop conservé) */
#menu > li.has-children > ul {
  position: absolute;
  top: 100%;
  left: 0;
  z-index: 1200;
  min-width: 14rem;
  margin: 0;
  padding: 0.35rem 0;
  list-style: none;
  background: var(--entry);
  border: 1px solid var(--border);
  border-radius: 0.5rem;
  box-shadow: 0 12px 28px rgba(0,0,0,0.22);
  display: none; /* caché par défaut */
}

/* Desktop (pointeur/hover) : ouvrir au survol */
@media (hover: hover) {
  #menu > li.has-children:hover > ul,
  #menu > li.has-children:focus-within > ul { display: block; }
}

/* Mobile (pas de hover) : ouverture via .is-open (voir mini-JS tap-to-open) */
@media (hover: none) {
  #menu > li.has-children.is-open > ul { display: block; }
}

/* Compat PaperMod quand le menu mobile est rendu en <details> */
.header .menu summary { cursor: pointer; list-style: none; }
.header .menu summary::-webkit-details-marker { display: none; }
.header .menu details > ul { display: none; }
.header .menu details[open] > ul { display: block; }

/* Eviter le clipping */
.header, .nav, header, nav { overflow: visible !important; }

/* Mise en page en lignes (bouton + texte) dans outils _index.md */
.post-content .tools-list {
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
  margin: 0.5rem 0 1rem;
}
.post-content .tools-list .tool-item {
  display: flex;
  align-items: center;
  /* l'espace entre bouton et texte est géré par le style inline "gap:.8rem" ci-dessus,
     ou mets-le ici si tu préfères: gap: .8rem; */
}

/* Conserver le look EXACT des boutons "Téléchargements" */
.post-content .tools-list .he-btn,
.post-content .tools-list .he-btn--neutral,
.post-content .tools-list .he-btn--sm {
  margin: 0 !important;              /* pas de marge parasite */
  /* ne PAS redéfinir background/border/color/radius => on garde le style natif du shortcode */
}

/* Pas de souligné sur liens/texte */
.post-content .tools-list .tool-item a,
.post-content .tools-list .tool-item span {
  text-decoration: none !important;
}

/* (Optionnel) un peu plus d'espace interne dans le bouton */
.post-content .tools-list .he-btn,
.post-content .tools-list .he-btn--neutral {
  padding-left: 0.85rem;
  padding-right: 0.85rem;
}

/* Outils : resserrer l'espacement vertical entre les lignes */
.post-content .tools-list {
  gap: 0.60rem;          /* était ~0.6rem */
}

/* Neutraliser d'éventuelles marges imposées par dl-row */
.post-content .tools-list .tool-item.dl-row {
  margin: 0 !important;
}

/* Resserre un peu la hauteur du texte à droite du bouton */
.post-content .tools-list .tool-item span {
  line-height: 1.0;      /* 1.4–1.6 par défaut : à ajuster au goût */
}
